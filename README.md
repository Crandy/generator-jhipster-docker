# generator-jhipster-docker
[![NPM version][npm-image]][npm-url] [![Build Status][travis-image]][travis-url] [![Dependency Status][daviddm-image]][daviddm-url]
> Docker JHipster module, Docker support in your JHipster application

<div align="center">
  <a href="http://jhipster.github.io">
    <img src="https://github.com/pascalgrimaud/generator-jhipster-docker/raw/master/images/logo-jhipster.png">
  </a>
  <a href="https://www.docker.com/">
    <img width=200px src="https://github.com/pascalgrimaud/generator-jhipster-docker/raw/master/images/logo-docker.png">
  </a>
</div>



## Prerequisites

As this is a [JHipster](http://jhipster.github.io/) module, we expect you have JHipster and its related tools already installed:

- [Installing JHipster](https://jhipster.github.io/installation.html)

You have to install Docker and Docker Compose:

- [Docker](https://docs.docker.com/installation/#installation)
- [Docker Compose](https://docs.docker.com/compose/install)

All these images come from the official [Docker Hub](https://hub.docker.com/):

- [MySQL](https://hub.docker.com/_/mysql/)
- [PostgreSQL](https://hub.docker.com/_/postgres/)
- [MongoDB](https://hub.docker.com/_/mongo/)
- [Cassandra](https://hub.docker.com/_/cassandra/)
- [Elasticsearch](https://hub.docker.com/_/elasticsearch/)
- [SonarQube](https://hub.docker.com/_/sonarqube/)



## Installation

To install this module:

```bash
npm install -g generator-jhipster-docker
```

To update this module:
```bash
npm update -g generator-jhipster-docker
```


## Usage

This is a [JHipster](http://jhipster.github.io/) module, that is meant to be use in a JHipster application.

To run the module on a JHipster generated application:

```bash
yo jhipster-docker
```

You can use this command to generate docker-compose services with default options:

```bash
yo jhipster-docker default --force
```



### 1 - Generate docker-compose services

#### 1.1 - Description

When using the option `Generating docker-compose services`, if your project uses MySQL, PostgreSQL, MongoDB or Cassandra, these files will be generated in your folder project:

- docker-compose.yml : to start the service(s) in DEV profile
- docker-compose-prod.yml : to start the service(s) in PROD profile
- docker/sonar.yml : to start a sonar instance

If your project uses Elasticsearch as search engine, the configuration will be included in the `docker-compose-prod.yml` file.

So you can use docker-compose to start your database in development or production profile.



#### 1.2 - Working with databases with MySQL, PostgreSQL, MongoDB

##### In development profile:

```bash
docker-compose up -d
```

##### In production profile

It will start Elasticsearch too if you selected it as search engine:

```bash
docker-compose -f docker-compose-prod.yml up -d
```


#### 1.3 - Working with Cassandra

##### In development profile:

- Build the image, which will contain the CQL scripts generated by your project for initializing the database:

```bash
docker-compose build
```

- Start the container (it will show the container id):

```bash
docker-compose up -d
```

- Initialize the database by creating the Keyspace and the Tables:

```bash
docker exec -it "container id" init
```

##### In production profile:

- Build the image:

```bash
docker-compose -f docker-compose-prod.yml build
```

- Start the container (it will show the container id):

```bash
docker-compose -f docker-compose-prod.yml up -d
```

- Initialize the database by creating the Keyspace and the Tables:

```bash
docker exec -it "container id" init
```


##### Starting Cassandra the next times

In development profile:

```bash
docker-compose up -d
```

In production profile:

```bash
docker-compose -f docker-compose-prod.yml up -d
```

##### Starting Cassandra with Clusters

- Build the image:

```bash
docker-compose -f docker-compose-node.yml build
```

- Start the container (it will show the container id):

```bash
docker-compose -f docker-compose-node.yml up -d
```

- Initialize the database by creating the Keyspace and the Tables:

```bash
docker exec -it "container id" init
```

- Add X other nodes:

```bash
docker-compose -f docker-compose-node.yml scale <name_of_your_app>-cassandra-node=X
```

- Manage nodes with OpsCenter: http://localhost:8888

- Before starting your application in production profile, add in your `application-prod.yml` every IP of containers to the key `spring.data.cassandra.contactPoints`



#### 1.4 - Common commands

##### List the containers

You can use `docker ps -a` to list all the containers

    $ docker ps -a
    CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
    fc35e1090021        mysql               "/entrypoint.sh mysql"   4 seconds ago       Up 4 seconds        0.0.0.0:3306->3306/tcp   sampleapplication-mysql


##### Stop the containers

In development profile:

```bash
docker-compose stop
```

In production profile:

```bash
docker-compose -f docker-compose-prod.yml stop
```

You can use directly docker:

```bash
docker stop "container id"
```

When you stop a container, the data are not deleted, unless you delete the container.

##### Delete a container

Be carefull! All data will be deleted (unless you used volumes):

```bash
docker rm "container id"
```



### 2 - Automated build at the [Docker Hub](https://hub.docker.com)

#### 2.1 - generate the files

- Launch : `yo jhipster-docker`
- Select the second option : `Generate files for Automated build`
- Answer all questions

#### 2.2 - param your Docker Hub project

- go to [https://hub.docker.com/r/username/](https://hub.docker.com/r/username/) (replace username by yours)
- menu Create:
    - Create Automated Build
    - select the repository
    - put a description, then click on create
<div align="center">
  <a href="http://jhipster.github.io">
    <img src="https://github.com/pascalgrimaud/generator-jhipster-docker/raw/master/images/automated-step1.png">
  </a>
  <br/>
  <a href="https://www.docker.com/">
    <img src="https://github.com/pascalgrimaud/generator-jhipster-docker/raw/master/images/automated-step2.png">
  </a>
</div>


- go to Build Settings
    - choose your branch or let master by default
    - put this Dockerfile location: /docker/hub/
    - click on Save Changes
<div align="center">
  <a href="https://www.docker.com/">
    <img src="https://github.com/pascalgrimaud/generator-jhipster-docker/raw/master/images/automated-step3.png">
  </a>
</div>


- return to this project: git commit and push these changes!
- go to Build details: it should be a new line with Building
- go to Repo info and copy/paste in Full description the docker/app-hub.yml



### 3 - Local build and push image to [Docker Hub](https://hub.docker.com/)

This option is used to build a Docker image for running the JHipster application.
You can read this documentation for more details:
[spring-boot-docker](https://spring.io/guides/gs/spring-boot-docker/)

If you want, you can push your Docker image to Docker Hub.



## License

Apache-2.0 Â© [Pascal Grimaud](https://twitter.com/pascalgrimaud)

[npm-image]: https://img.shields.io/npm/v/generator-jhipster-docker.svg
[npm-url]: https://npmjs.org/package/generator-jhipster-docker
[travis-image]: https://travis-ci.org/pascalgrimaud/generator-jhipster-docker.svg?branch=master
[travis-url]: https://travis-ci.org/pascalgrimaud/generator-jhipster-docker
[daviddm-image]: https://david-dm.org/pascalgrimaud/generator-jhipster-docker.svg?theme=shields.io
[daviddm-url]: https://david-dm.org/pascalgrimaud/generator-jhipster-docker
